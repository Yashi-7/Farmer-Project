<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ¦ï¸ Live Weather Advisory</title>
  <style>

    /* .cont {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  
  flex-wrap: wrap;
  padding: 15px 20px;
  margin: 25px auto;
  border-radius: 15px;
  border: 1px solid #cfd8dc;
  background-color: #fff;
  max-width: 900px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
} */
label {
  font-weight: 600;
  color: #396270;
}
select {
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid #90a4ae;
  font-size: 1em;
  cursor: pointer;
  background: #fafafa;
  transition: 0.3s;
}
select:hover {
  border-color: #2e7d32;
}

    #liveWeatherInfo {
  margin: 20px auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  max-width: 800px;
  font-size: 1.05em;
  line-height: 1.6;
}
#liveWeatherInfo strong {
  color: #2e7d32;
}

#liveWeatherInfo h4 {
  margin-top: 20px;
  color: #396270;
}
#liveWeatherInfo > div {
  margin-bottom: 12px;
  padding: 12px;
  border-radius: 10px;
  background: #f9f9f9;
  border-left: 4px solid #2e7d32;
}

#liveWeatherInfo > div:hover {
  background: #f1faf5;
  transform: translateY(-2px);
  transition: all 0.2s ease-in-out;
}


    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f8f5;
      color: #333;
    }
    h1 {
      color: #396270;
      text-align: center;
    }
    select {
      margin: 10px 0;
      padding: 6px;
      font-size: 1em;
    }
    #liveWeatherInfo {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    hr {
      margin: 20px 0;
    }

    .cont{
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
      padding: 10px;
      margin: 35px;
      border-radius: 25px;
      border: 1px solid #ccc;
       box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      background-color: #fffbea;   
    }

  </style>
</head>
<body>
  <h1 id="weatherTitle">ğŸŒ¦ï¸ Live Weather Advisory</h1>

  <div class="cont">
  <label for="languageSelect">ğŸŒ Language:</label>
  <select id="languageSelect">
    <option value="en">English</option>
    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
    <option value="ml">à´®à´²à´¯à´¾à´³à´‚</option>
  </select>


  <label for="districtSelect">ğŸï¸ District:</label>
  <select id="districtSelect">
    <option value="Thiruvananthapuram">Thiruvananthapuram</option>
    <option value="Kollam">Kollam</option>
    <option value="Pathanamthitta">Pathanamthitta</option>
    <option value="Alappuzha">Alappuzha</option>
    <option value="Kottayam">Kottayam</option>
    <option value="Idukki">Idukki</option>
    <option value="Ernakulam">Ernakulam</option>
    <option value="Thrissur">Thrissur</option>
    <option value="Palakkad">Palakkad</option>
    <option value="Malappuram">Malappuram</option>
    <option value="Kozhikode">Kozhikode</option>
    <option value="Wayanad">Wayanad</option>
    <option value="Kannur">Kannur</option>
    <option value="Kasaragod">Kasaragod</option>
  </select>

  

  <label for="cropSelect">ğŸŒ¾ Crop:</label>
  <select id="cropSelect">
    <option value="paddy">Paddy</option>
    <option value="banana">Banana</option>
    <option value="coconut">Coconut</option>
    <option value="pepper">Pepper</option>
    <option value="vegetables">Vegetables</option>
    <option value="arecanut">Arecanut</option>
  </select>
</div>
  <div id="liveWeatherInfo"></div>

  <!-- Weather Advisory Script -->
  <script>
    let LANGUAGE = "en";
    let SELECTED_CROP = "paddy";
   // ğŸŒ Translations
const weatherTranslations = {
  en: {
    title: "Live Weather Advisory",
    error: "Error fetching weather.",
    unavailable: "Weather data unavailable.",
    labels: {
      temp: "Temperature",
      wind: "Wind Speed",
      humidity: "Humidity",
      condition: "Condition",
      precipitation: "Rain Chance",
      advisory: "Advisory"
    }
  },
  hi: {
    title: "à¤¤à¤¾à¤œà¤¼à¤¾ à¤®à¥Œà¤¸à¤® à¤¸à¤²à¤¾à¤¹",
    error: "à¤®à¥Œà¤¸à¤® à¤¡à¥‡à¤Ÿà¤¾ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿à¥¤",
    unavailable: "à¤®à¥Œà¤¸à¤® à¤¡à¥‡à¤Ÿà¤¾ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
    labels: {
      temp: "à¤¤à¤¾à¤ªà¤®à¤¾à¤¨",
      wind: "à¤ªà¤µà¤¨ à¤—à¤¤à¤¿",
      humidity: "à¤¨à¤®à¥€",
      condition: "à¤¸à¥à¤¥à¤¿à¤¤à¤¿",
      precipitation: "à¤µà¤°à¥à¤·à¤¾ à¤¸à¤‚à¤­à¤¾à¤µà¤¨à¤¾",
      advisory: "à¤¸à¤²à¤¾à¤¹"
    }
  },
  ml: {
    title: "à´¤à´¤àµà´¸à´®à´¯ à´•à´¾à´²à´¾à´µà´¸àµà´¥à´¾ à´‰à´ªà´¦àµ‡à´¶à´‚",
    error: "à´•à´¾à´²à´¾à´µà´¸àµà´¥à´¾ à´¡à´¾à´±àµà´± à´²à´­àµà´¯à´®à´¾à´•àµà´•àµà´¨àµà´¨à´¤à´¿àµ½ à´ªà´¿à´¶à´•àµ.",
    unavailable: "à´•à´¾à´²à´¾à´µà´¸àµà´¥à´¾ à´¡à´¾à´±àµà´± à´²à´­àµà´¯à´®à´²àµà´².",
    labels: {
      temp: "à´¤à´¾à´ªà´¨à´¿à´²",
      wind: "à´•à´¾à´±àµà´±à´¿à´¨àµà´±àµ† à´µàµ‡à´—à´¤",
      humidity: "à´†àµ¼à´¦àµà´°à´¤",
      condition: "à´•à´¾à´²à´¾à´µà´¸àµà´¥",
      precipitation: "à´®à´´à´¯àµà´Ÿàµ† à´¸à´¾à´§àµà´¯à´¤",
      advisory: "à´‰à´ªà´¦àµ‡à´¶à´‚"
    }
  }
};

const advisoryTranslations = {
  en: {
    transplanting: "âœ… Good for transplanting and irrigation.",
    avoidTransplanting: "âš  Heavy rain may damage seedlings. Avoid transplanting.",
    highWind: "ğŸ’¨ High wind. Avoid spraying.",
    fieldPrep: "â„¹ï¸ Monitor soil moisture. Ideal for field prep.",
    waterlogging: "âš  Risk of waterlogging. Ensure drainage.",
    suckerPlanting: "âœ… Good for sucker planting.",
    interculturalOps: "â„¹ï¸ Stable weather. Proceed with intercultural operations.",
    basinIrrigation: "âœ… Ideal for basin irrigation.",
    pestNeutral: "â„¹ï¸ Monitor pest activity. Weather is neutral.",
    mulching: "âœ… Good for mulching and nutrient application.",
    leafDamage: "ğŸ’¨ Avoid spraying. Risk of leaf damage.",
    seedRot: "âš  Delay sowing. Risk of seed rot.",
    leafySowing: "âœ… Favorable for sowing leafy vegetables.",
    nurseryMgmt: "â„¹ï¸ Proceed with nursery management.",
    runoffRisk: "âš  Avoid pesticide spraying. Risk of runoff.",
    fertilizer: "âœ… Good for fertilizer application.",
    crownRot: "â„¹ï¸ Monitor crown rot. Weather is manageable.",
    stable: "â„¹ï¸ Weather stable. Proceed with regular activities."
  },
  hi: {
    transplanting: "âœ… à¤°à¥‹à¤ªà¤¾à¤ˆ à¤”à¤° à¤¸à¤¿à¤‚à¤šà¤¾à¤ˆ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    avoidTransplanting: "âš  à¤­à¤¾à¤°à¥€ à¤µà¤°à¥à¤·à¤¾ à¤¸à¥‡ à¤ªà¥Œà¤§à¥‹à¤‚ à¤•à¥‹ à¤¨à¥à¤•à¤¸à¤¾à¤¨ à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤°à¥‹à¤ªà¤¾à¤ˆ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚à¥¤",
    highWind: "ğŸ’¨ à¤¤à¥‡à¤œà¤¼ à¤¹à¤µà¤¾à¥¤ à¤›à¤¿à¤¡à¤¼à¤•à¤¾à¤µ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚à¥¤",
    fieldPrep: "â„¹ï¸ à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥€ à¤¨à¤®à¥€ à¤•à¥€ à¤¨à¤¿à¤—à¤°à¤¾à¤¨à¥€ à¤•à¤°à¥‡à¤‚à¥¤ à¤–à¥‡à¤¤ à¤¤à¥ˆà¤¯à¤¾à¤°à¥€ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    waterlogging: "âš  à¤œà¤²à¤­à¤°à¤¾à¤µ à¤•à¤¾ à¤–à¤¤à¤°à¤¾à¥¤ à¤œà¤² à¤¨à¤¿à¤•à¤¾à¤¸à¥€ à¤¸à¥à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤ à¤•à¤°à¥‡à¤‚à¥¤",
    suckerPlanting: "âœ… à¤¸à¤•à¤° à¤²à¤—à¤¾à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    interculturalOps: "â„¹ï¸ à¤®à¥Œà¤¸à¤® à¤¸à¥à¤¥à¤¿à¤° à¤¹à¥ˆà¥¤ à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤•à¤¾à¤°à¥à¤¯ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚à¥¤",
    basinIrrigation: "âœ… à¤¬à¥‡à¤¸à¤¿à¤¨ à¤¸à¤¿à¤‚à¤šà¤¾à¤ˆ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    pestNeutral: "â„¹ï¸ à¤•à¥€à¤Ÿ à¤—à¤¤à¤¿à¤µà¤¿à¤§à¤¿ à¤•à¥€ à¤¨à¤¿à¤—à¤°à¤¾à¤¨à¥€ à¤•à¤°à¥‡à¤‚à¥¤ à¤®à¥Œà¤¸à¤® à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤¹à¥ˆà¥¤",
    mulching: "âœ… à¤®à¤²à¥à¤šà¤¿à¤‚à¤— à¤”à¤° à¤ªà¥‹à¤·à¤• à¤¤à¤¤à¥à¤µ à¤¦à¥‡à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    leafDamage: "ğŸ’¨ à¤›à¤¿à¤¡à¤¼à¤•à¤¾à¤µ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚à¥¤ à¤ªà¤¤à¥à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¥‹ à¤¨à¥à¤•à¤¸à¤¾à¤¨ à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤",
    seedRot: "âš  à¤¬à¥à¤µà¤¾à¤ˆ à¤Ÿà¤¾à¤²à¥‡à¤‚à¥¤ à¤¬à¥€à¤œ à¤¸à¤¡à¤¼à¤¨à¥‡ à¤•à¤¾ à¤–à¤¤à¤°à¤¾à¥¤",
    leafySowing: "âœ… à¤ªà¤¤à¥à¤¤à¥‡à¤¦à¤¾à¤° à¤¸à¤¬à¥à¤œà¤¿à¤¯à¥‹à¤‚ à¤•à¥€ à¤¬à¥à¤µà¤¾à¤ˆ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤¨à¥à¤•à¥‚à¤²à¥¤",
    nurseryMgmt: "â„¹ï¸ à¤¨à¤°à¥à¤¸à¤°à¥€ à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚à¥¤",
    runoffRisk: "âš  à¤›à¤¿à¤¡à¤¼à¤•à¤¾à¤µ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚à¥¤ à¤¬à¤¹à¤¾à¤µ à¤•à¤¾ à¤–à¤¤à¤°à¤¾à¥¤",
    fertilizer: "âœ… à¤‰à¤°à¥à¤µà¤°à¤• à¤¦à¥‡à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤‰à¤ªà¤¯à¥à¤•à¥à¤¤à¥¤",
    crownRot: "â„¹ï¸ à¤•à¥à¤°à¤¾à¤‰à¤¨ à¤°à¥‰à¤Ÿ à¤•à¥€ à¤¨à¤¿à¤—à¤°à¤¾à¤¨à¥€ à¤•à¤°à¥‡à¤‚à¥¤ à¤®à¥Œà¤¸à¤® à¤…à¤¨à¥à¤•à¥‚à¤² à¤¹à¥ˆà¥¤",
    stable: "â„¹ï¸ à¤®à¥Œà¤¸à¤® à¤¸à¥à¤¥à¤¿à¤° à¤¹à¥ˆà¥¤ à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯ à¤•à¤¾à¤°à¥à¤¯ à¤•à¤°à¥‡à¤‚à¥¤"
  },
  ml: {
    transplanting: "âœ… à´¨à´Ÿàµà´Ÿàµ à´¨à´¿àµ½à´•àµà´•à´¾à´¨àµà´‚ à´œà´²à´¸àµ‡à´šà´¨à´¤àµà´¤à´¿à´¨àµà´‚ à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    avoidTransplanting: "âš  à´¶à´•àµà´¤à´®à´¾à´¯ à´®à´´ à´šàµ†à´Ÿà´¿à´•àµ¾à´•àµà´•àµ à´¹à´¾à´¨à´¿à´•à´°à´®à´¾à´£àµ. à´¨à´Ÿàµà´Ÿàµ à´¨à´¿àµ½à´•àµà´•àµà´¨àµà´¨à´¤àµ à´’à´´à´¿à´µà´¾à´•àµà´•àµà´•.",
    highWind: "ğŸ’¨ à´¶à´•àµà´¤à´®à´¾à´¯ à´•à´¾à´±àµà´±àµ. à´¸àµà´ªàµà´°àµ‡ à´šàµ†à´¯àµà´¯àµà´¨àµà´¨à´¤àµ à´’à´´à´¿à´µà´¾à´•àµà´•àµà´•.",
    fieldPrep: "â„¹ï¸ à´®à´£àµà´£à´¿à´²àµ† à´ˆàµ¼à´ªàµà´ªà´‚ à´¨à´¿à´°àµ€à´•àµà´·à´¿à´•àµà´•àµà´•. à´µà´¯àµ½ à´¤à´¯àµà´¯à´¾à´±à´¾à´•àµà´•à´¾àµ» à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    waterlogging: "âš  à´µàµ†à´³àµà´³à´‚ à´•àµ†à´Ÿàµà´Ÿà´¿ à´¨à´¿àµ½à´•àµà´•à´¾à´¨àµà´³àµà´³ à´¸à´¾à´§àµà´¯à´¤. à´¡àµà´°àµ†à´¯à´¿à´¨àµ‡à´œàµ à´‰à´±à´ªàµà´ªà´¾à´•àµà´•àµà´•.",
    suckerPlanting: "âœ… à´¸à´•àµà´•àµ¼ à´¨à´Ÿàµà´Ÿàµà´µà´¯àµà´•àµà´•à´¾àµ» à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    interculturalOps: "â„¹ï¸ à´•à´¾à´²à´¾à´µà´¸àµà´¥ à´¸àµà´¥à´¿à´°à´®à´¾à´£àµ. à´¸à´¾à´§à´¾à´°à´£ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¨à´™àµà´™àµ¾ à´¤àµà´Ÿà´°àµà´•.",
    basinIrrigation: "âœ… à´¬àµ‡à´¸à´¿àµ» à´œà´²à´¸àµ‡à´šà´¨à´¤àµà´¤à´¿à´¨àµà´‚ à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    pestNeutral: "â„¹ï¸ à´•àµ€à´Ÿ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¨à´‚ à´¨à´¿à´°àµ€à´•àµà´·à´¿à´•àµà´•àµà´•. à´•à´¾à´²à´¾à´µà´¸àµà´¥ à´¸à´¾à´§à´¾à´°à´£à´®à´¾à´£àµ.",
    mulching: "âœ… à´®àµ¾à´šàµà´šà´¿à´‚à´—à´¿à´¨àµà´‚ à´ªàµ‹à´·à´•à´™àµà´™àµ¾ à´¨àµ½à´•àµà´¨àµà´¨à´¤à´¿à´¨àµà´‚ à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    leafDamage: "ğŸ’¨ à´¸àµà´ªàµà´°àµ‡ à´’à´´à´¿à´µà´¾à´•àµà´•àµà´•. à´‡à´²à´•àµ¾à´•àµà´•àµ à´¹à´¾à´¨à´¿à´•à´°à´®à´¾à´£àµ.",
    seedRot: "âš  à´µà´¿à´¤à´šàµà´š à´µà´¿à´¤àµà´¤àµà´•àµ¾ à´•àµà´´à´¯à´¾à´¨àµà´³àµà´³ à´¸à´¾à´§àµà´¯à´¤. à´µà´¿à´¤à´¯àµà´•àµà´•àµà´¨àµà´¨à´¤àµ à´’à´´à´¿à´µà´¾à´•àµà´•àµà´•.",
    leafySowing: "âœ… à´‡à´²à´•àµà´•à´±à´¿à´•àµ¾ à´µà´¿à´¤à´¯àµà´•àµà´•à´¾àµ» à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    nurseryMgmt: "â„¹ï¸ à´¨à´´àµâ€Œà´¸à´±à´¿ à´®à´¾à´¨àµ‡à´œàµà´®àµ†à´¨àµà´±àµ à´¤àµà´Ÿà´°àµà´•.",
    runoffRisk: "âš  à´¸àµà´ªàµà´°àµ‡ à´’à´´à´¿à´µà´¾à´•àµà´•àµà´•. à´’à´´àµà´•à´¿ à´ªàµ‹à´•à´¾à´¨àµà´³àµà´³ à´¸à´¾à´§àµà´¯à´¤.",
    fertilizer: "âœ… à´µà´³à´‚ à´¨àµ½à´•à´¾àµ» à´…à´¨àµà´¯àµ‹à´œàµà´¯à´‚.",
    crownRot: "â„¹ï¸ à´•àµà´°àµ—àµº à´±àµ‹à´Ÿàµà´Ÿà´¿à´¨àµà´±àµ† à´¨à´¿à´°àµ€à´•àµà´·à´£à´‚ à´¨à´Ÿà´¤àµà´¤àµà´•. à´•à´¾à´²à´¾à´µà´¸àµà´¥ à´…à´¨àµà´¯àµ‹à´œàµà´¯à´®à´¾à´£àµ.",
    stable: "â„¹ï¸ à´•à´¾à´²à´¾à´µà´¸àµà´¥ à´¸àµà´¥à´¿à´°à´®à´¾à´£àµ. à´¸à´¾à´§à´¾à´°à´£ à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¨à´™àµà´™àµ¾ à´¤àµà´Ÿà´°àµà´•."
  }
};

const districtCoordinates = {
  Thiruvananthapuram: { lat: 8.5241, lon: 76.9366 },
  Kollam: { lat: 8.8811, lon: 76.5846 },
  Pathanamthitta: { lat: 9.2647, lon: 76.7870 },
  Alappuzha: { lat: 9.4981, lon: 76.3388 },
  Kottayam: { lat: 9.5916, lon: 76.5222 },
  Idukki: { lat: 9.8490, lon: 77.1150 },
  Ernakulam: { lat: 10.0850, lon: 76.5843 },
  Thrissur: { lat: 10.5276, lon: 76.2144 },
  Palakkad: { lat: 10.7867, lon: 76.6548 },
  Malappuram: { lat: 11.0734, lon: 76.0711 },
  Kozhikode: { lat: 11.2588, lon: 75.7804 },
  Wayanad: { lat: 11.7154, lon: 76.1320 },
  Kannur: { lat: 11.8745, lon: 75.3704 },
  Kasaragod: { lat: 12.5000, lon: 75.0000 }
};

function updateHeaders() {
  const titleEl = document.getElementById("weatherTitle");
  if (titleEl) titleEl.innerText = "Live Weather Advisory";
}

function updateWeatherLabels() {
  const t = weatherTranslations[LANGUAGE];
  const titleEl = document.getElementById("weatherTitle");
  if (titleEl) titleEl.innerText = t.title;
}

function getCropAdvisory(crop, rain, humidity, maxTemp, wind) {
  const a = advisoryTranslations[LANGUAGE];
  switch (crop.toLowerCase()) {
    case "paddy":
      if (rain >= 70) return a.avoidTransplanting;
      if (rain >= 40 && humidity >= 80) return a.transplanting;
      if (wind >= 25) return a.highWind;
      return a.fieldPrep;
    case "banana":
      if (rain >= 60) return a.waterlogging;
      if (humidity >= 85 && maxTemp <= 35) return a.suckerPlanting;
      return a.intercultural ;     return a.interculturalOps;

    case "coconut":
      if (rain >= 70) return a.runoffRisk;
      if (humidity >= 75 && wind < 20) return a.basinIrrigation;
      return a.pestNeutral;

    case "pepper":
      if (rain >= 50 && humidity >= 80) return a.mulching;
      if (wind >= 30) return a.leafDamage;
      return a.pestNeutral;

    case "vegetables":
      if (rain >= 60) return a.seedRot;
      if (humidity >= 80 && maxTemp <= 32) return a.leafySowing;
      return a.nurseryMgmt;

    case "arecanut":
      if (rain >= 70) return a.runoffRisk;
      if (humidity >= 75 && wind < 20) return a.fertilizer;
      return a.crownRot;

    default:
      return a.stable;
  }
}
function updateHeaders() {
  const titleEl = document.getElementById("weatherTitle");
  if (titleEl) titleEl.innerText = "Live Weather Advisory";
}

function updateWeatherLabels() {
  const t = weatherTranslations[LANGUAGE];
  const titleEl = document.getElementById("weatherTitle");
  if (titleEl) titleEl.innerText = t.title;
}
const weatherCodesLocalized = {
  0: { en: "Clear sky â˜€", hi: "à¤¸à¤¾à¤«à¤¼ à¤†à¤•à¤¾à¤¶ â˜€", ml: "à´¸àµà´µà´šàµà´›à´®à´¾à´¯ à´†à´•à´¾à´¶à´‚ â˜€" },
  1: { en: "Mainly clear ğŸŒ¤", hi: "à¤®à¥à¤–à¥à¤¯à¤¤à¤ƒ à¤¸à¤¾à¤«à¤¼ ğŸŒ¤", ml: "à´…à´§à´¿à´•à´‚ à´¸àµà´µà´šàµà´›à´‚ ğŸŒ¤" },
  2: { en: "Partly cloudy â›…", hi: "à¤†à¤‚à¤¶à¤¿à¤• à¤°à¥‚à¤ª à¤¸à¥‡ à¤¬à¤¾à¤¦à¤² â›…", ml: "à´­à´¾à´—à´¿à´•à´®à´¾à´¯à´¿ à´®àµ‡à´˜à´¾à´µàµƒà´¤à´‚ â›…" },
  3: { en: "Overcast â˜", hi: "à¤ªà¥‚à¤°à¤¾ à¤¬à¤¾à¤¦à¤² â˜", ml: "à´®àµà´´àµà´µàµ» à´®àµ‡à´˜à´¾à´µàµƒà´¤à´‚ â˜" },
  45: { en: "Fog ğŸŒ«", hi: "à¤•à¥‹à¤¹à¤°à¤¾ ğŸŒ«", ml: "à´®àµ‚à´Ÿàµ½à´®à´àµà´àµ ğŸŒ«" },
  61: { en: "Light rain ğŸŒ§", hi: "à¤¹à¤²à¥à¤•à¥€ à¤¬à¤¾à¤°à¤¿à¤¶ ğŸŒ§", ml: "à´‡à´³à´¿à´¯ à´®à´´ ğŸŒ§" },
  80: { en: "Rain showers ğŸŒ¦", hi: "à¤¬à¤¾à¤°à¤¿à¤¶ à¤•à¥€ à¤¬à¥Œà¤›à¤¾à¤°à¥‡à¤‚ ğŸŒ¦", ml: "à´®à´´à´¯àµà´Ÿàµ† à´¤àµà´³àµà´³à´¿à´•àµ¾ ğŸŒ¦" }
};
// ğŸŒ¦ï¸ Fetch weather manually by district
async function fetchLiveWeather(district = "Thiruvananthapuram", crop = "paddy") {
  const coords = districtCoordinates[district];
  const t = weatherTranslations[LANGUAGE];
  const infoBox = document.getElementById("liveWeatherInfo");

  if (!infoBox || !coords) {
    infoBox.innerText = t.unavailable;
    return;
  }

  const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,windspeed_10m_max,precipitation_probability_max&hourly=relative_humidity_2m,precipitation_probability&timezone=auto`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    if (data && data.current_weather) {
      const temp = data.current_weather.temperature;
      const wind = data.current_weather.windspeed;
      const code = data.current_weather.weathercode;
      const condition = weatherCodesLocalized[code]?.[LANGUAGE] || "Unknown";

      let humidity = "â€”", rainChance = "â€”";
      const nowHour = new Date().toISOString().slice(0, 13);
      const index = data.hourly.time.findIndex(t => t.startsWith(nowHour));
      if (index !== -1) {
        humidity = data.hourly.relative_humidity_2m?.[index] + "%" || "â€”";
        rainChance = data.hourly.precipitation_probability?.[index] + "%" || "â€”";
      }

      const advisory = getCropAdvisory(crop, parseInt(rainChance), parseInt(humidity), temp, wind);

      infoBox.innerHTML = `
        <strong>${t.labels.temp}:</strong> ${temp}Â°C<br>
        <strong>${t.labels.wind}:</strong> ${wind} km/h<br>
        <strong>${t.labels.humidity}:</strong> ${humidity}<br>
        <strong>${t.labels.precipitation}:</strong> ${rainChance}<br>
        <strong>${t.labels.condition}:</strong> ${condition}<br>
        <strong>${t.labels.advisory}:</strong> ${advisory}
      `;
    } else {
      infoBox.innerText = t.unavailable;
    }

    // ğŸ“… 3-Day Forecast
    if (data && data.daily) {
      const daily = data.daily;
      let forecastHTML = `<hr><h4>ğŸ“… 3-Day Forecast</h4>`;

      for (let i = 0; i < 3; i++) {
        const dateObj = new Date(daily.time[i]);
        const date = dateObj.toLocaleDateString();
        const day = dateObj.toLocaleDateString(undefined, { weekday: 'long' });

        const min = daily.temperature_2m_min[i];
        const max = daily.temperature_2m_max[i];
        const wind = daily.windspeed_10m_max?.[i] ?? "â€”";
        const rain = daily.precipitation_probability_max?.[i] ?? "â€”";
        const code = daily.weathercode[i];
        const condition = weatherCodesLocalized[code]?.[LANGUAGE] || "Unknown";

        let humidity = "â€”";
        const targetHour = daily.time[i] + "T08:00";
        const index = data.hourly.time.findIndex(t => t === targetHour);
        if (index !== -1) {
          humidity = data.hourly.relative_humidity_2m[index] + "%";
        }

        const advisory = getCropAdvisory(crop, parseInt(rain), parseInt(humidity), max, wind);

        forecastHTML += `
          <div style="margin-bottom: 12px; padding: 8px; border-left: 3px solid #007BFF;">
            <strong>${day}, ${date}</strong><br>
            ğŸŒ¡ ${t.labels.temp}: ${min}Â°C â€“ ${max}Â°C<br>
            ğŸ’§ ${t.labels.humidity}: ${humidity}<br>
            ğŸŒ¬ ${t.labels.wind}: ${wind} km/h<br>
            â˜” ${t.labels.precipitation}: ${rain}%<br>
            ğŸŒ¥ ${t.labels.condition}: ${condition}<br>
            ğŸŒ¾ ${t.labels.advisory}: ${advisory}
          </div>
        `;
      }

      infoBox.innerHTML += forecastHTML;
    }
  } catch (err) {
    console.error("Weather fetch failed:", err);
    infoBox.innerText = t.error;
  }
}

document.getElementById("languageSelect").addEventListener("change", (e) => {
  LANGUAGE = e.target.value;
  updateWeatherLabels();
  SELECTED_CROP = document.getElementById("cropSelect").value;
  fetchLiveWeather(document.getElementById("districtSelect").value, SELECTED_CROP);
});

document.getElementById("districtSelect").addEventListener("change", (e) => {
  SELECTED_CROP = document.getElementById("cropSelect").value;
  fetchLiveWeather(e.target.value, SELECTED_CROP);
});

document.getElementById("cropSelect").addEventListener("change", (e) => {
  SELECTED_CROP = e.target.value;
  fetchLiveWeather(document.getElementById("districtSelect").value, SELECTED_CROP);
});

window.onload = function () {
  updateHeaders();
  updateWeatherLabels();
  SELECTED_CROP = document.getElementById("cropSelect").value;
  fetchLiveWeather(document.getElementById("districtSelect").value, SELECTED_CROP);
};
  </script>
</body>
</html>